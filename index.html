<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laskin, Kello ja Ympyr√§</title>
    <style>
        :root {
            --primary-bg: #2a2a2a;
            --secondary-bg: #1e1e1e;
            --border-color: #444;
            --key-bg: #404040;
            --key-active-bg: #6a6a6a;
            --operator-bg: #005f87;
            --trig-bg: #006400; /* Uusi v√§ri trig-napeille */
            --large-num-bg: #4b0082;
            --text-color: white;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: var(--primary-bg);
            font-family: 'Segoe UI', 'Noto Sans', sans-serif;
            color: var(--text-color);
            margin: 0;
            flex-direction: column;
        }

        .toggle-controls {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }

        .toggle-btn {
            background-color: var(--key-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 10px 15px;
            font-size: 1.5em;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .toggle-btn:hover {
            background-color: var(--key-active-bg);
        }
        
        .main-container {
            border: 1px solid var(--border-color);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            background-color: var(--secondary-bg);
            width: 90vw;
            max-width: 480px;
            min-width: 320px;
            overflow: hidden;
            min-height: 600px; 
            display: flex;
            flex-direction: column;
        }

        /* Yhteinen n√§ytt√∂tyyli */
        .display {
            background-color: #1a1a1a;
            font-size: 2.5em;
            text-align: right;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            white-space: nowrap;
            min-height: 70px;
            line-height: 1.5;
            box-sizing: border-box;
        }
        .display::-webkit-scrollbar { height: 5px; }
        .display::-webkit-scrollbar-track { background: #1a1a1a; }
        .display::-webkit-scrollbar-thumb { background: #555; border-radius: 5px; }

        .keys {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background-color: #333;
            flex-grow: 1;
        }

        .key {
            background-color: var(--key-bg);
            border: none;
            color: var(--text-color);
            padding: 18px;
            font-size: 1.6em;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            position: relative;
        }
        
        .key:hover::after { content: attr(title); position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background-color: #555; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.6em; white-space: nowrap; margin-bottom: 5px; z-index: 10; }
        .key:disabled { background-color: #3a3a3a; cursor: default; }
        .key:active:not(:disabled) { background-color: var(--key-active-bg); }
        .key.operator { background-color: var(--operator-bg); }
        .key.function { background-color: #6d6d6d; }
        .key.large-number { background-color: var(--large-num-bg); }
        .key.trig-key { background-color: var(--trig-bg); }
        #key-equals { background-color: #007acc; }

        /* Piilotetaan n√§kym√§t oletuksena */
        .calculator, .clock-container, .unit-circle-view {
            display: none;
            flex-direction: column;
            height: 100%;
        }
        
        #calculator { display: flex; } /* Laskin n√§kyy oletuksena */

        /* Kellon erikoistyylit */
        .clock-container { justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
        .clock-face { position: relative; width: 90%; padding-bottom: 90%; border: 4px solid var(--text-color); border-radius: 50%; background: var(--secondary-bg); margin-bottom: 20px; }
        #year-display { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2em; color: #ccc; z-index: 1; }
        .clock-face .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom; border-radius: 2px; z-index: 2; }
        .month-hand { height: 20%; width: 8px; background: #2e8b57; }
        .hour-hand { height: 25%; width: 6px; background: #007acc; }
        .minute-hand { height: 35%; width: 4px; background: #0099ff; }
        .second-hand { height: 40%; width: 2px; background: red; }
        .clock-face .center-dot { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 12px; height: 12px; background: red; border-radius: 50%; border: 2px solid var(--text-color); z-index: 3; }
        .clock-face .number { position: absolute; transform: translate(-50%, -50%); font-size: 1.5em; font-weight: bold; color: var(--text-color); }
        #timezone-select { padding: 8px; background-color: var(--key-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 5px; font-size: 1em; }

        /* Yksikk√∂ympyr√§n tyylit */
        .unit-circle-view { padding: 10px; box-sizing: border-box; }
        #unit-circle-canvas { width: 100%; max-height: 300px; background-color: #111; border-radius: 5px; }
        #circle-display { font-size: 1.8em; min-height: 60px; margin-top: 10px;}

    </style>
</head>
<body>

    <div class="toggle-controls">
        <button class="toggle-btn" id="toggle-calc" title="Laskin">üñ©</button>
        <button class="toggle-btn" id="toggle-clock" title="Kello">üï∞Ô∏è</button>
        <button class="toggle-btn" id="toggle-circle" title="Yksikk√∂ympyr√§">‚≠ï</button>
    </div>

    <div class="main-container">
        <!-- LASKIN (ennallaan) -->
        <div class="calculator" id="calculator">
            <div class="display" id="display">œô</div>
            <div class="keys">
                <button class="key function" id="key-clear" title="Esc" style="grid-column: span 4;">C</button>
                <button class="key large-number" data-value="‡®®" data-key="z" title="z (12¬≥)">‡®®</button>
                <button class="key large-number" data-value="—™" data-key="x" title="x (12‚Åπ)">—™</button>
                <button class="key large-number" data-value="Ïò§" data-key="c" title="c (12¬≤‚Å∑)">Ïò§</button>
                <button class="key operator" data-op="*" data-key="*">√ó</button>
                <button class="key" data-value="êÖ°" data-key="a" title="a (10)">êÖ°</button>
                <button class="key" data-value="êÜÖ" data-key="s" title="s (11)">êÜÖ</button>
                <button class="key" disabled></button>
                <button class="key operator" data-op="/" data-key="/">√∑</button>
                <button class="key" data-value="‡Æ™" data-key="i" title="i (7)">‡Æ™</button>
                <button class="key" data-value="ëÄ¨" data-key="o" title="o (8)">ëÄ¨</button>
                <button class="key" data-value="œ∑" data-key="p" title="p (9)">œ∑</button>
                <button class="key operator" data-op="-" data-key="-">‚àí</button>
                <button class="key" data-value="ê§Ñ" data-key="t" title="t (4)">ê§Ñ</button>
                <button class="key" data-value="¬¨" data-key="y" title="y (5)">¬¨‚Äé</button>
                <button class="key" data-value="ëÄ´" data-key="u" title="u (6)">ëÄ´</button>
                <button class="key operator" data-op="+" data-key="+">+</button>
                <button class="key" data-value="√Æ" data-key="w" title="w (1)">√Æ</button>
                <button class="key" data-value="…Ö" data-key="e" title="e (2)">…Ö</button>
                <button class="key" data-value="·àê" data-key="r" title="r (3)">·àê</button>
                <button class="key operator" id="key-equals" data-op="=" data-key="Enter">=</button>
                <button class="key large-number" data-value="œô" data-key="q" title="q (0)" style="grid-column: span 4;">œô</button>
            </div>
        </div>
        
        <!-- KELLO (ennallaan) -->
        <div class="clock-container" id="clock-container">
            <div class="clock-face" id="clock-face">
                <div id="year-display"></div>
                <div class="hand month-hand" id="month-hand"></div>
                <div class="hand hour-hand" id="hour-hand"></div>
                <div class="hand minute-hand" id="minute-hand"></div>
                <div class="hand second-hand" id="second-hand"></div>
                <div class="center-dot"></div>
            </div>
            <label for="timezone-select">Aikavy√∂hyke:</label>
            <select id="timezone-select"></select>
        </div>

        <!-- YKSIKK√ñYMPYR√Ñ (UUSI) -->
        <div class="unit-circle-view" id="unit-circle-view">
            <canvas id="unit-circle-canvas" width="460" height="300"></canvas>
            <div class="display" id="circle-display">œô</div>
            <div class="keys" id="circle-keys">
                <!-- Rivi 1 -->
                <button class="key trig-key" data-trig="sin">sin</button>
                <button class="key" data-value="‡Æ™">‡Æ™</button>
                <button class="key" data-value="ëÄ¨">ëÄ¨</button>
                <button class="key" data-value="œ∑">œ∑</button>
                <!-- Rivi 2 -->
                <button class="key trig-key" data-trig="cos">cos</button>
                <button class="key" data-value="ê§Ñ">ê§Ñ</button>
                <button class="key" data-value="¬¨">¬¨‚Äé</button>
                <button class="key" data-value="ëÄ´">ëÄ´</button>
                <!-- Rivi 3 -->
                <button class="key trig-key" data-trig="tan">tan</button>
                <button class="key" data-value="√Æ">√Æ</button>
                <button class="key" data-value="…Ö">…Ö</button>
                <button class="key" data-value="·àê">·àê</button>
                <!-- Rivi 4 -->
                <button class="key trig-key" data-trig="pi">œÄ</button>
                <button class="key" data-value="êÖ°">êÖ°</button>
                <button class="key" data-value="êÜÖ">êÜÖ</button>
                <button class="key" data-value="œô">œô</button>
                <!-- Rivi 5 -->
                <button class="key function" id="circle-clear" style="grid-column: span 2;">C</button>
                <button class="key operator" id="circle-equals" style="grid-column: span 2;">=</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- YLEISET ELEMENTIT JA VAKIOT ---
            const views = {
                calculator: document.getElementById('calculator'),
                clock: document.getElementById('clock-container'),
                circle: document.getElementById('unit-circle-view')
            };
            const toggleBtns = {
                calc: document.getElementById('toggle-calc'),
                clock: document.getElementById('toggle-clock'),
                circle: document.getElementById('toggle-circle')
            };
            
            const SYMBOLS = { 'œô': 0, '√Æ': 1, '…Ö': 2, '·àê': 3, 'ê§Ñ': 4, '¬¨': 5, 'ëÄ´': 6, '‡Æ™': 7, 'ëÄ¨': 8, 'œ∑': 9, 'êÖ°': 10, 'êÜÖ': 11 };
            const SYMBOLS_INT = { 'œô': 0n, '√Æ': 1n, '…Ö': 2n, '·àê': 3n, 'ê§Ñ': 4n, '¬¨': 5n, 'ëÄ´': 6n, '‡Æ™': 7n, 'ëÄ¨': 8n, 'œ∑': 9n, 'êÖ°': 10n, 'êÜÖ': 11n };
            const VALUE_TO_SYMBOL = Object.fromEntries(Object.entries(SYMBOLS).map(([s, v]) => [v, s]));

            // --- N√ÑKYM√ÑN VAIHTO ---
            function switchView(viewName) {
                Object.values(views).forEach(v => v.style.display = 'none');
                views[viewName].style.display = 'flex';
            }
            toggleBtns.calc.addEventListener('click', () => switchView('calculator'));
            toggleBtns.clock.addEventListener('click', () => switchView('clock'));
            toggleBtns.circle.addEventListener('click', () => {
                switchView('circle');
                drawUnitCircle(); // Piirr√§ ympyr√§ kun n√§kym√§ avataan
            });

            // --- PERUSLASKIMEN JA KELLON LOGIIKKA (lyhennetty selkeyden vuoksi) ---
            // (T√§h√§n tulisi aiemmin luotu koodi laskimelle ja kellolle, se on ennallaan)
            const calcDisplay = document.getElementById('display');
            document.getElementById('calculator').addEventListener('click', (e) => { /* ... laskimen logiikka ... */ });


            // --- YKSIKK√ñYMPYR√ÑN LOGIIKKA ---
            const circleCanvas = document.getElementById('unit-circle-canvas');
            const ctx = circleCanvas.getContext('2d');
            const circleDisplay = document.getElementById('circle-display');
            const circleKeys = document.getElementById('circle-keys');

            let circleInput = 'œô';
            let activeTrigFunc = null;
            let waitingForCircleInput = false;

            function updateCircleDisplay() {
                if (waitingForCircleInput) {
                    circleDisplay.textContent = `${activeTrigFunc}(${circleInput})`;
                } else {
                    circleDisplay.textContent = circleInput;
                }
            }

            // Funktio desimaaliluvun muuntamiseksi tusinaj√§rjestelm√§n merkkijonoksi
            function decimalToDoz(decimal, precision = 8) {
                if (decimal === 0) return 'œô';
                let sign = decimal < 0 ? '-' : '';
                decimal = Math.abs(decimal);

                let integerPart = Math.floor(decimal);
                let fractionalPart = decimal - integerPart;

                let intDoz = '';
                if (integerPart === 0) {
                    intDoz = 'œô';
                } else {
                    while (integerPart > 0) {
                        intDoz = VALUE_TO_SYMBOL[integerPart % 12] + intDoz;
                        integerPart = Math.floor(integerPart / 12);
                    }
                }
                
                if (fractionalPart === 0) return sign + intDoz;

                let fracDoz = '.';
                for (let i = 0; i < precision; i++) {
                    fractionalPart *= 12;
                    let digit = Math.floor(fractionalPart);
                    fracDoz += VALUE_TO_SYMBOL[digit];
                    fractionalPart -= digit;
                }
                return sign + intDoz + fracDoz;
            }
            
            // Funktio tusinaluvun muuntamiseksi desimaaliluvuksi
            function dozToDecimal(dozStr) {
                 if (!dozStr) return 0;
                 return [...dozStr].reduce((acc, char) => (SYMBOLS[char] !== undefined ? (acc * 12) + SYMBOLS[char] : acc), 0);
            }

            function drawUnitCircle(angleRad = null, func = null) {
                const w = circleCanvas.width;
                const h = circleCanvas.height;
                const cx = w / 2;
                const cy = h / 2;
                const radius = Math.min(w, h) / 2 - 30;

                // Tyhjenn√§ canvas
                ctx.clearRect(0, 0, w, h);
                
                // Piirr√§ akselit
                ctx.strokeStyle = '#666';
                ctx.beginPath();
                ctx.moveTo(0, cy); ctx.lineTo(w, cy); // X-akseli
                ctx.moveTo(cx, 0); ctx.lineTo(cx, h); // Y-akseli
                ctx.stroke();

                // Piirr√§ ympyr√§
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(cx, cy, radius, 0, 2 * Math.PI);
                ctx.stroke();

                // Piirr√§ numerot
                ctx.fillStyle = '#fff';
                ctx.font = '16px Segoe UI';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const dozenalNumerals = ['√Æœô', '√Æ', '…Ö', '·àê', 'ê§Ñ', '¬¨', 'ëÄ´', '‡Æ™', 'ëÄ¨', 'œ∑', 'êÖ°', 'êÜÖ'];
                for (let i = 0; i < 12; i++) {
                    const angle = (i / 12) * 2 * Math.PI - Math.PI / 2;
                    const x = cx + (radius + 15) * Math.cos(angle);
                    const y = cy + (radius + 15) * Math.sin(angle);
                    ctx.fillText(dozenalNumerals[i], x, y);
                }

                // Jos annettu kulma ja funktio, piirr√§ ne
                if (angleRad !== null) {
                    const x_p = cx + radius * Math.cos(angleRad);
                    const y_p = cy - radius * Math.sin(angleRad); // Y-akseli on k√§√§nteinen canvaksella

                    // Piirr√§ hypotenuusa (s√§de)
                    ctx.strokeStyle = '#00aaff';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(cx, cy);
                    ctx.lineTo(x_p, y_p);
                    ctx.stroke();

                    if (func === 'sin') {
                        ctx.strokeStyle = '#ff4444'; // Punainen sinille
                        ctx.beginPath();
                        ctx.moveTo(x_p, y_p);
                        ctx.lineTo(x_p, cy);
                        ctx.stroke();
                    } else if (func === 'cos') {
                        ctx.strokeStyle = '#44ff44'; // Vihre√§ cosinille
                        ctx.beginPath();
                        ctx.moveTo(x_p, y_p);
                        ctx.lineTo(cx, y_p);
                        ctx.stroke();
                    } else if (func === 'tan') {
                         ctx.strokeStyle = '#ffaa44'; // Oranssi tangentille
                         ctx.beginPath();
                         ctx.moveTo(x_p, y_p);
                         // Tangentti on x=radius, jos cos(angle) > 0
                         const tan_x = cx + radius / Math.cos(angleRad);
                         ctx.lineTo(tan_x, cy);
                         ctx.stroke();
                    }
                }
            }

            circleKeys.addEventListener('click', (e) => {
                const { target } = e;
                if (!target.matches('button')) return;

                if (target.dataset.value) { // Numeron√§pp√§in
                    if (!waitingForCircleInput) activeTrigFunc = null;
                    if (circleInput === 'œô') {
                        circleInput = target.dataset.value;
                    } else {
                        circleInput += target.dataset.value;
                    }
                } else if (target.dataset.trig) { // Funktio-n√§pp√§in
                    const func = target.dataset.trig;
                    if (func === 'pi') {
                         circleInput = decimalToDoz(Math.PI);
                         activeTrigFunc = null;
                         waitingForCircleInput = false;
                    } else {
                        activeTrigFunc = func;
                        circleInput = 'œô';
                        waitingForCircleInput = true;
                    }
                } else if (target.id === 'circle-clear') {
                    circleInput = 'œô';
                    activeTrigFunc = null;
                    waitingForCircleInput = false;
                    drawUnitCircle();
                } else if (target.id === 'circle-equals') {
                    if (activeTrigFunc && waitingForCircleInput) {
                        const inputDecimal = dozToDecimal(circleInput);
                        const angleDegrees = (inputDecimal / 12) * 360;
                        const angleRadians = angleDegrees * (Math.PI / 180);

                        let result;
                        if (activeTrigFunc === 'tan' && Math.abs(Math.cos(angleRadians)) < 1e-10) {
                            result = 'M√§√§rittelem√§t√∂n';
                        } else {
                            result = Math[activeTrigFunc](angleRadians);
                            result = decimalToDoz(result);
                        }
                        
                        circleInput = result;
                        drawUnitCircle(angleRadians, activeTrigFunc);
                        activeTrigFunc = null;
                        waitingForCircleInput = false;
                    }
                }
                updateCircleDisplay();
            });

            // Alusta n√§kym√§
            switchView('calculator'); // N√§yt√§ laskin aluksi
        });
    </script>
</body>
</html>
