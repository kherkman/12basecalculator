<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tusinaalij√§rjestelm√§n Laskin (Korjattu)</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #2a2a2a;
            font-family: 'Segoe UI', 'Noto Sans', sans-serif;
            color: white;
            margin: 0;
        }

        .calculator {
            border: 1px solid #444;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            background-color: #1e1e1e;
            width: 100%;
            max-width: 400px;
            overflow: hidden;
        }

        .display {
            background-color: #1a1a1a;
            color: #fff;
            font-size: 2.5em;
            text-align: right;
            padding: 20px;
            border-bottom: 1px solid #444;
            overflow-x: auto;
            white-space: nowrap;
            box-sizing: border-box;
            min-height: 70px;
            line-height: 1.5;
        }
        /* Scrollbar-tyylit n√§yt√∂lle */
        .display::-webkit-scrollbar {
            height: 5px;
        }
        .display::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        .display::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 5px;
        }

        .keys {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background-color: #333;
        }

        .key {
            background-color: #404040;
            border: none;
            color: white;
            padding: 18px;
            font-size: 1.6em;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            position: relative;
        }
        
        .key:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #555;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.6em;
            white-space: nowrap;
            margin-bottom: 5px;
            z-index: 10;
        }

        .key:active {
            background-color: #6a6a6a;
        }

        .key.operator { background-color: #005f87; }
        .key.operator:active { background-color: #007cb5; }

        .key.function { background-color: #6d6d6d; }
        .key.function:active { background-color: #8a8a8a; }
        
        .key.large-number { background-color: #4b0082; }
        .key.large-number:active { background-color: #6a0dad; }

        #key-equals {
            grid-column: span 2;
            background-color: #007acc;
        }
        #key-equals:active { background-color: #0099ff; }
    </style>
</head>
<body>

    <div class="calculator">
        <div class="display" id="display">œô</div>
        <div class="keys">
            <!-- Rivi 1 -->
            <button class="key function" id="key-clear" title="Esc">C</button>
            <button class="key large-number" data-value="‡®®" data-key="z" title="z (12¬≥)">‡®®</button>
            <button class="key large-number" data-value="—™" data-key="x" title="x (12‚Åπ)">—™</button>
            <button class="key operator" data-op="/" data-key="/" title="/">√∑</button>
            <!-- Rivi 2 -->
            <button class="key" data-value="‡Æ™" data-key="i" title="i (7)">‡Æ™</button>
            <button class="key" data-value="ëÄ¨" data-key="o" title="o (8)">ëÄ¨</button>
            <button class="key" data-value="œ∑" data-key="p" title="p (9)">œ∑</button>
            <button class="key operator" data-op="*" data-key="*" title="*">√ó</button>
            <!-- Rivi 3 -->
            <button class="key" data-value="ê§Ñ" data-key="t" title="t (4)">ê§Ñ</button>
            <button class="key" data-value="¬¨" data-key="y" title="y (5)">¬¨‚Äé</button>
            <button class="key" data-value="ëÄ´" data-key="u" title="u (6)">ëÄ´</button>
            <button class="key operator" data-op="-" data-key="-" title="-">‚àí</button>
            <!-- Rivi 4 -->
            <button class="key" data-value="√Æ" data-key="w" title="w (1)">√Æ</button>
            <button class="key" data-value="…Ö" data-key="e" title="e (2)">…Ö</button>
            <button class="key" data-value="·àê" data-key="r" title="r (3)">·àê</button>
            <button class="key operator" data-op="+" data-key="+" title="+">+</button>
            <!-- Rivi 5 -->
            <button class="key" data-value="œô" data-key="q" title="q (0)">œô</button>
            <button class="key" data-value="êÖ°" data-key="a" title="a (10)">êÖ°</button>
            <button class="key" data-value="êÜÖ" data-key="s" title="s (11)">êÜÖ</button>
            <button class="key operator" id="key-equals" data-op="=" data-key="Enter" title="Enter">=</button>
             <!-- Rivi 6 -->
            <button class="key large-number" data-value="Ïò§" data-key="c" title="c (12¬≤‚Å∑)" style="grid-column: span 4;">Ïò§</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const display = document.getElementById('display');
            const keys = document.querySelector('.keys');

            const SYMBOLS = {
                'œô': 0n, '√Æ': 1n, '…Ö': 2n, '·àê': 3n, 'ê§Ñ': 4n, '¬¨': 5n,
                'ëÄ´': 6n, '‡Æ™': 7n, 'ëÄ¨': 8n, 'œ∑': 9n, 'êÖ°': 10n, 'êÜÖ': 11n
            };

            const LARGE_NUMBERS = {
                '‡®®': 12n ** 3n,
                '—™': 12n ** 9n,
                'Ïò§': 12n ** 27n
            };
            
            const VALUE_TO_SYMBOL = Object.fromEntries(Object.entries(SYMBOLS).map(([s, v]) => [v, s]));

            const KEY_MAP = {
                'q': 'œô', 'w': '√Æ', 'e': '…Ö', 'r': '·àê', 't': 'ê§Ñ', 'y': '¬¨',
                'u': 'ëÄ´', 'i': '‡Æ™', 'o': 'ëÄ¨', 'p': 'œ∑', 'a': 'êÖ°', 's': 'êÜÖ',
                'z': '‡®®', 'x': '—™', 'c': 'Ïò§',
                '+': '+', '-': '-', '*': '*', '/': '/',
                '=': '=', 'Enter': '=',
                'Escape': 'C', 'Delete': 'C',
                'Backspace': 'Backspace'
            };
            
            let displayValue = 'œô';
            let firstOperand = null;
            let operator = null;
            let waitingForSecondOperand = false;

            const updateDisplay = () => display.textContent = displayValue;

            const toDecimal = (dozenalStr) => {
                return [...dozenalStr].reduce((acc, char) => {
                    if (SYMBOLS[char] === undefined) return acc;
                    return (acc * 12n) + SYMBOLS[char];
                }, 0n);
            };

            const toDoz = (decimalBigInt) => {
                if (decimalBigInt === 0n) return 'œô';
                if (decimalBigInt < 0n) return '-' + toDoz(-decimalBigInt);

                let result = '';
                let num = decimalBigInt;
                while (num > 0n) {
                    const remainder = num % 12n;
                    result = VALUE_TO_SYMBOL[remainder] + result;
                    num = num / 12n;
                }
                return result;
            };

            const inputDigit = (digit) => {
                if (waitingForSecondOperand) {
                    displayValue = digit;
                    waitingForSecondOperand = false;
                } else {
                    displayValue = (displayValue === 'œô') ? digit : displayValue + digit;
                }
            };
            
            const inputLargeNumber = (symbol) => {
                 displayValue = toDoz(LARGE_NUMBERS[symbol]);
                 waitingForSecondOperand = false;
            };

            const performCalculation = () => {
                if (operator === null || firstOperand === null) return;
                
                const secondOperand = toDecimal(displayValue);
                if (operator === '/' && secondOperand === 0n) {
                    alert("Nollalla jako ei ole sallittu.");
                    return 'error';
                }

                let result = 0n;
                switch (operator) {
                    case '+': result = firstOperand + secondOperand; break;
                    case '-': result = firstOperand - secondOperand; break;
                    case '*': result = firstOperand * secondOperand; break;
                    case '/': result = firstOperand / secondOperand; break;
                }
                return result;
            };

            const handleOperator = (nextOperator) => {
                const inputValue = toDecimal(displayValue);

                if (operator && waitingForSecondOperand) {
                    operator = nextOperator;
                    return;
                }

                if (firstOperand === null) {
                    firstOperand = inputValue;
                } else if (operator) {
                    const result = performCalculation();
                    if (result === 'error') {
                        resetCalculator();
                        return;
                    }
                    displayValue = toDoz(result);
                    firstOperand = result;
                }
                
                waitingForSecondOperand = true;
                operator = nextOperator;
                updateDisplay();
            };

            const resetCalculator = () => {
                displayValue = 'œô';
                firstOperand = null;
                operator = null;
                waitingForSecondOperand = false;
                updateDisplay();
            };
            
            keys.addEventListener('click', (event) => {
                const { target } = event;
                if (!target.matches('button')) return;

                if (target.dataset.value) { // Numeeriset ja suuret luvut
                    if (LARGE_NUMBERS[target.dataset.value]) {
                        inputLargeNumber(target.dataset.value);
                    } else {
                        inputDigit(target.dataset.value);
                    }
                } else if (target.dataset.op) { // Operaattorit
                    if (target.dataset.op === '=') {
                        const result = performCalculation();
                        if (result === 'error') {
                             resetCalculator();
                             return;
                        }
                        if (result !== undefined) {
                            displayValue = toDoz(result);
                            operator = null;
                            firstOperand = null; 
                            waitingForSecondOperand = true;
                        }
                    } else {
                        handleOperator(target.dataset.op);
                    }
                } else if (target.id === 'key-clear') {
                    resetCalculator();
                }
                updateDisplay();
            });
            
            document.addEventListener('keydown', (event) => {
                if (event.key === ' ' || event.key === 'Enter') event.preventDefault();
                
                const action = KEY_MAP[event.key];
                if (!action) return;

                if (action === 'Backspace') {
                    displayValue = displayValue.length > 1 ? displayValue.slice(0, -1) : 'œô';
                    updateDisplay();
                    return;
                }
                
                const button = document.querySelector(`[data-key="${event.key}"]`) || 
                               document.querySelector(`[data-value="${action}"]`) || 
                               document.getElementById(`key-clear`);
                
                if (button) {
                    button.click();
                    button.style.transform = 'scale(0.95)';
                    setTimeout(() => button.style.transform = '', 100);
                }
            });
        });
    </script>
</body>
</html>
