<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laskin, Kello, Ympyr√§ ja Muut</title>
    <style>
        :root {
            --primary-bg: #2a2a2a;
            --secondary-bg: #1e1e1e;
            --border-color: #444;
            --key-bg: #404040;
            --key-active-bg: #6a6a6a;
            --operator-bg: #005f87;
            --trig-bg: #006400; 
            --large-num-bg: #4b0082;
            --text-color: white;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: var(--primary-bg);
            font-family: 'Segoe UI', 'Noto Sans', sans-serif;
            color: var(--text-color);
            margin: 0;
            flex-direction: column;
        }

        .toggle-controls {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .toggle-btn {
            background-color: var(--key-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 10px 15px;
            font-size: 1.5em; 
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .toggle-btn:hover {
            background-color: var(--key-active-bg);
        }
        
        .main-container {
            border: 1px solid var(--border-color);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            background-color: var(--secondary-bg);
            width: 90vw;
            max-width: 480px;
            min-width: 320px;
            overflow: hidden;
            min-height: 650px; 
            display: flex;
            flex-direction: column;
        }

        /* Yhteinen n√§ytt√∂tyyli */
        .display {
            background-color: #1a1a1a;
            font-size: 2.5em;
            text-align: right;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            white-space: nowrap;
            min-height: 70px;
            line-height: 1.5;
            box-sizing: border-box;
        }
        .display::-webkit-scrollbar { height: 5px; }
        .display::-webkit-scrollbar-track { background: #1a1a1a; }
        .display::-webkit-scrollbar-thumb { background: #555; border-radius: 5px; }

        .keys {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background-color: #333;
            flex-grow: 1;
        }
        
        .key {
            background-color: var(--key-bg);
            border: none;
            color: var(--text-color);
            padding: 18px;
            font-size: 1.6em;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            position: relative;
        }
        
        .key:hover::after { content: attr(title); position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background-color: #555; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.6em; white-space: nowrap; margin-bottom: 5px; z-index: 10; }
        .key:disabled { background-color: #3a3a3a; cursor: default; }
        .key:active:not(:disabled) { background-color: var(--key-active-bg); }
        .key.operator, .key.power-key { background-color: var(--operator-bg); }
        .key.function { background-color: #6d6d6d; }
        .key.large-number { background-color: var(--large-num-bg); }
        .key.trig-key { background-color: var(--trig-bg); }
        #key-equals, #circle-equals, #coords-equals { background-color: #007acc; }

        /* Piilotetaan n√§kym√§t oletuksena */
        .view-container {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }
        
        #calculator { display: flex; flex-grow: 1; } /* Laskin n√§kyy oletuksena */
        
        .calc-sub-view-container { display: flex; flex-direction: column; flex-grow: 1; }

        /* Laskimen sis√§inen navigointi */
        .calc-sub-nav {
            display: flex;
            justify-content: space-around;
            padding: 5px;
            background-color: #1a1a1a;
            border-bottom: 1px solid var(--border-color);
        }
        .calc-sub-nav button {
            background: none;
            border: 1px solid transparent;
            color: #aaa;
            padding: 8px 12px;
            font-size: 1.1em;
            cursor: pointer;
            border-radius: 5px;
        }
        .calc-sub-nav button:hover { background-color: #333; }
        .calc-sub-nav button.active { color: white; border-color: var(--operator-bg); }

        /* Muunnin ja Info -n√§kym√§t */
        #converter-view, #info-view {
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            flex-grow: 1;
        }
        #converter-view label { font-size: 1.2em; margin-bottom: 10px; display: block; }
        #converter-view textarea {
            width: 100%;
            height: 120px;
            background-color: #1a1a1a;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            font-size: 1.5em;
            padding: 10px;
            border-radius: 8px;
            box-sizing: border-box;
            resize: none;
            margin-bottom: 20px;
        }
        #info-view {
             white-space: pre-wrap;
             font-family: 'Courier New', Courier, monospace;
             font-size: 1.2em;
             line-height: 1.6;
             color: #ddd;
        }


        /* Kellon erikoistyylit */
        .clock-container { justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
        .clock-face { position: relative; width: 90%; padding-bottom: 90%; border: 4px solid var(--text-color); border-radius: 50%; background: var(--secondary-bg); margin-bottom: 20px; }
        #year-display { position: absolute; top: 75%; left: 50%; transform: translate(-50%, -50%); font-size: 2em; color: #ccc; z-index: 1; }
        #pm-indicator { position: absolute; top: 25%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5em; color: var(--text-color); z-index: 1;}
        .clock-face .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom; border-radius: 2px; z-index: 2; }
        .month-hand { height: 20%; width: 8px; background: #2e8b57; } .hour-hand { height: 25%; width: 6px; background: #007acc; } .minute-hand { height: 35%; width: 4px; background: #0099ff; } .second-hand { height: 40%; width: 2px; background: red; }
        .clock-face .center-dot { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 12px; height: 12px; background: red; border-radius: 50%; border: 2px solid var(--text-color); z-index: 3; }
        .clock-face .number { position: absolute; transform: translate(-50%, -50%); font-size: 1.5em; font-weight: bold; color: var(--text-color); }
        #timezone-select { padding: 8px; background-color: var(--key-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 5px; font-size: 1em; }

        /* Yksikk√∂ympyr√§n tyylit */
        .unit-circle-view { padding: 10px; box-sizing: border-box; justify-content: space-between; }
        #unit-circle-canvas { width: 100%; max-height: 300px; background-color: #111; border-radius: 5px; }
        #circle-display { font-size: 1.8em; min-height: 60px; margin-top: 10px;}
        .formula-display { padding: 10px; text-align: center; font-size: 1.1em; color: #ccc; min-height: 1.5em; font-family: 'Courier New', Courier, monospace; }
        .unit-circle-view .keys { flex-grow: 0; }

        /* Kertotaulun tyylit */
        #multiplication-table-view { padding: 10px; overflow: auto; }
        .mult-table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
        .mult-table th, .mult-table td { border: 1px solid #555; text-align: center; padding: 5px; min-width: 40px; font-size: 0.9em;}
        .mult-table th { background-color: #333; font-weight: bold; }
        #multiplication-table-view h2 { text-align: center; margin-top: 5px; margin-bottom: 10px; }


        /* Pianon tyylit */
        #piano-view { justify-content: center; align-items: center; }
        .piano { display: flex; position: relative; width: 280px; }
        .white-key, .black-key { border: 1px solid black; box-sizing: border-box; display: flex; justify-content: center; align-items: flex-end; padding-bottom: 1em; font-size: 1.2em; }
        .white-key { width: 40px; height: 200px; background-color: white; color: black; }
        .black-key { width: 25px; height: 120px; background-color: black; color: white; position: absolute; z-index: 1; }
        .black-key[data-key="√Æ"] { left: 27.5px; } 
        .black-key[data-key="ê§Ñ"] { left: 107.5px; } 
        .black-key[data-key="ëÄ´"] { left: 147.5px; }
        .black-key[data-key="œ∑"] { left: 227.5px; }
        .black-key[data-key="êÜÖ"] { left: 267.5px; }


         /* Koordinaatiston tyylit */
        .coordinate-system-view { padding: 10px; box-sizing: border-box; justify-content: flex-start; display: flex; flex-direction: column; flex-grow: 1; }
        #coords-canvas { width: 100%; height: 350px; background-color: #111; border-radius: 5px; }
        #coords-display { font-size: 1.8em; min-height: 40px; line-height: 40px; text-align: center; }
        #coords-keys { flex-shrink: 0; }
        .explanation-box {
            padding: 10px;
            margin-top: 10px;
            font-size: 0.8em;
            background-color: #252525;
            border-top: 1px solid var(--border-color);
            overflow-y: auto;
            flex-grow: 1;
            max-height: 120px;
        }
        .explanation-box h4 { margin-top: 5px; margin-bottom: 3px; color: var(--operator-bg); }
        .explanation-box p { margin-top: 0; margin-bottom: 8px; }

    </style>
</head>
<body>

    <div class="toggle-controls">
        <button class="toggle-btn" id="toggle-calc" title="Laskin">üñ©</button>
        <button class="toggle-btn" id="toggle-clock" title="Kello">üï∞Ô∏è</button>
        <button class="toggle-btn" id="toggle-circle" title="Yksikk√∂ympyr√§">‚≠ï</button>
        <button class="toggle-btn" id="toggle-table" title="Kertotaulu">‚ñ¶</button>
        <button class="toggle-btn" id="toggle-piano" title="Piano">üéπ</button>
        <button class="toggle-btn" id="toggle-coords" title="Koordinaatisto">üìà</button>
    </div>

    <div class="main-container">
        <div class="view-container calculator" id="calculator">
            <div class="calc-sub-nav">
                <button id="show-calc-btn" class="active">Laskin</button>
                <button id="show-converter-btn">Muunnin</button>
                <button id="show-info-btn">Info</button>
            </div>

            <div id="calc-sub-view" class="calc-sub-view-container">
                <div class="display" id="display">œô</div>
                <div class="keys" id="calc-keys">
                    <button class="key function" data-calc-op="clear" title="Esc" style="grid-column: span 4;">C</button>
                    <button class="key large-number" data-value="‡®®">‡®®</button><button class="key large-number" data-value="—™">—™</button><button class="key large-number" data-value="Ïò§">Ïò§</button><button class="key operator" data-calc-op="*">√ó</button>
                    <button class="key" data-value="êÖ°">êÖ°</button><button class="key" data-value="êÜÖ">êÜÖ</button><button class="key" disabled></button><button class="key operator" data-calc-op="/">√∑</button>
                    <button class="key" data-value="‡Æ™">‡Æ™</button><button class="key" data-value="ëÄ¨">ëÄ¨</button><button class="key" data-value="œ∑">œ∑</button><button class="key operator" data-calc-op="-">‚àí</button>
                    <button class="key" data-value="ê§Ñ">ê§Ñ</button><button class="key" data-value="¬¨">¬¨‚Äé</button><button class="key" data-value="ëÄ´">ëÄ´</button><button class="key operator" data-calc-op="+">+</button>
                    <button class="key" data-value="√Æ">√Æ</button><button class="key" data-value="…Ö">…Ö</button><button class="key" data-value="·àê">·àê</button><button class="key operator" id="key-equals" data-calc-op="=">=</button>
                    <button class="key large-number" data-value="œô" style="grid-column: span 4;">œô</button>
                </div>
            </div>

            <div id="converter-view" class="calc-sub-view-container" style="display: none;">
                <label for="doz-input">Tusinaj√§rjestelm√§:</label>
                <textarea id="doz-input"></textarea>
                <label for="dec-input">Desimaalij√§rjestelm√§:</label>
                <textarea id="dec-input"></textarea>
            </div>

            <div id="info-view" class="calc-sub-view-container" style="display: none;">
œô: yl 
√Æ: un .
…Ö: hi ‚Äé..
·àê: he ‚Ä¶
ê§Ñ: fi ‚Ä¶.
¬¨‚Äé: fe ‚Ä¶.. 
ëÄ´: si ‚Ä¶‚Ä¶
‡Æ™: se ‚Ä¶‚Ä¶.
ëÄ¨: mi ‚Ä¶‚Ä¶.. 
œ∑: me ‚Ä¶‚Ä¶‚Ä¶
êÖ°: di ‚Ä¶‚Ä¶‚Ä¶.
êÜÖ: de ‚Ä¶‚Ä¶‚Ä¶..
√Æœô: unyl ‚Ä¶‚Ä¶‚Ä¶‚Ä¶

‡®®: ul = œôœôœô
—™: il = ‡®®‡®®‡®®
Ïò§: ol = —™—™—™
            </div>
        </div>
        
        <div class="view-container clock-container" id="clock-container">
            <div class="clock-face" id="clock-face">
                <div id="year-display"></div>
                <div id="pm-indicator"></div>
                <div class="hand month-hand" id="month-hand"></div><div class="hand hour-hand" id="hour-hand"></div><div class="hand minute-hand" id="minute-hand"></div><div class="hand second-hand" id="second-hand"></div><div class="center-dot"></div>
            </div>
            <label for="timezone-select">Aikavy√∂hyke:</label>
            <select id="timezone-select"></select>
        </div>

        <div class="view-container unit-circle-view" id="unit-circle-view">
            <canvas id="unit-circle-canvas" width="460" height="300"></canvas>
            <div class="display" id="circle-display">œô</div>
            <div>
                <div class="keys" id="circle-keys">
                    <button class="key trig-key" data-trig="pi">œÄ</button><button class="key" data-circle-val="êÖ°">êÖ°</button><button class="key" data-circle-val="êÜÖ">êÜÖ</button><button class="key large-number" data-circle-val="œô">œô</button>
                    <button class="key trig-key" data-trig="sin">sin</button><button class="key" data-circle-val="‡Æ™">‡Æ™</button><button class="key" data-circle-val="ëÄ¨">ëÄ¨</button><button class="key" data-circle-val="œ∑">œ∑</button>
                    <button class="key trig-key" data-trig="cos">cos</button><button class="key" data-circle-val="ê§Ñ">ê§Ñ</button><button class="key" data-circle-val="¬¨">¬¨‚Äé</button><button class="key" data-circle-val="ëÄ´">ëÄ´</button>
                    <button class="key trig-key" data-trig="tan">tan</button><button class="key" data-circle-val="√Æ">√Æ</button><button class="key" data-circle-val="…Ö">…Ö</button><button class="key" data-circle-val="·àê">·àê</button>
                    <button class="key trig-key" data-trig="phi">œÜ</button><button class="key function" id="circle-clear" style="grid-column: span 2;">C</button><button class="key operator" id="circle-equals">=</button>
                </div>
                <div class="formula-display" id="formula-display"></div>
            </div>
        </div>

        <div class="view-container" id="multiplication-table-view">
            <!-- Taulut lis√§t√§√§n t√§nne JavaScriptill√§ -->
        </div>

        <div class="view-container" id="piano-view">
             <div class="piano">
                <!-- White keys -->
                <div class="white-key" data-key="œô">œô</div>
                <div class="white-key" data-key="…Ö">…Ö</div>
                <div class="white-key" data-key="·àê">·àê</div>
                <div class="white-key" data-key="¬¨">¬¨</div>
                <div class="white-key" data-key="‡Æ™">‡Æ™</div>
                <div class="white-key" data-key="ëÄ¨">ëÄ¨</div>
                <div class="white-key" data-key="êÖ°">êÖ°</div>
                <!-- Black keys -->
                <div class="black-key" data-key="√Æ">√Æ</div>
                <div class="black-key" data-key="ê§Ñ">ê§Ñ</div>
                <div class="black-key" data-key="ëÄ´">ëÄ´</div>
                <div class="black-key" data-key="œ∑">œ∑</div>
                <div class="black-key" data-key="êÜÖ">êÜÖ</div>
            </div>
        </div>

        <div class="view-container coordinate-system-view" id="coordinate-system-view">
            <canvas id="coords-canvas"></canvas>
            <div class="display" id="coords-display">Valitse funktio</div>
            <div class="keys" id="coords-keys" style="grid-template-columns: repeat(5, 1fr);">
                 <button class="key power-key" data-power="2">x¬≤</button>
                 <button class="key power-key" data-power="3">x¬≥</button>
                 <button class="key power-key" data-power="4">x‚Å¥</button>
                 <button class="key power-key" data-power="5">x‚Åµ</button>
                 <button class="key function" data-func="sqrt">‚àöz</button>
                 
                 <button class="key trig-key" data-func="sin">sin(z)</button>
                 <button class="key trig-key" data-func="cos">cos(z)</button>
                 <button class="key trig-key" data-func="tan">tan(z)</button>
                 <button class="key trig-key" data-func="sinh">sinh(z)</button>
                 <button class="key trig-key" data-func="sinc">sinc(z)</button>
                 
                 <button class="key function" data-func="log">log(z)</button>
                 <button class="key function" data-func="exp">e·∂ª</button>
                 <button class="key function" data-func="gamma" title="Gamma-funktio">Œì(z)</button>
                 <button class="key function" data-func="zeta" title="Riemannin zeeta-funktio">Œ∂(z)</button>
                 <button class="key function" id="coords-clear" style="grid-column: span 5;">C</button>
            </div>
            <div class="explanation-box">
                <h4>Tietoa kuvaajista</h4>
                <p>N√§m√§ 3D-kuvaajat esitt√§v√§t, miten funktiot k√§ytt√§ytyv√§t kompleksitasolla. Akselit ovat: <br>
                - <b>X-akseli (punainen):</b> Sy√∂tteen reaaliosa, <b>Re(z)</b> <br>
                - <b>Z-akseli (sininen):</b> Sy√∂tteen imaginaariosa, <b>Im(z)</b> <br>
                - <b>Y-akseli (vihre√§):</b> Funktion tuloksen reaaliosa, <b>Re(f(z))</b> (paitsi Gamma-funktiolla, josta n√§ytet√§√§n itseisarvo |Œì(z)|).</p>
                <h4>Uudet funktiot</h4>
                <p><b>‚àöz (Neli√∂juuri):</b> Kompleksiluvun neli√∂juuri. Kuvaaja n√§ytt√§√§ spiraalimaiselta pinnalta, jossa on "leikkaus" negatiivisella reaaliakselilla.</p>
                <p><b>sinh(z) (Hyperbolinen sini):</b> T√§rke√§ funktio fysiikassa ja tekniikassa, kuvaa mm. roikkuvia ketjuja. On jaksollinen imaginaariakselin suunnassa.</p>
                <p><b>sinc(z) (Sinc-funktio):</b> Signaalink√§sittelyss√§ k√§ytetty funktio (sin(z)/z), joka muodostaa vaimenevia, samankeskisi√§ aaltoja.</p>
                <p><b>Œì(z) (Gamma-funktio):</b> Kertoman yleistys kompleksiluvuille. Sill√§ on navat (pystysuorat "piikit") negatiivisissa kokonaisluvuissa.</p>
                <p><b>Œ∂(z) (Riemannin zeeta-funktio):</b> Yksi matematiikan kuuluisimmista funktioista, liittyy alkulukujen jakautumiseen ja ratkaisemattomaan Riemannin hypoteesiin.</p>
            </div>
        </div>

    </div>

    <script type="importmap">{ "imports": { "three": "https://unpkg.com/three@0.164.1/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.164.1/examples/jsm/" } }</script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        
        document.addEventListener('DOMContentLoaded', () => {
            // --- YLEISET ELEMENTIT JA VAKIOT ---
            const views = {
                calc: document.getElementById('calculator'),
                clock: document.getElementById('clock-container'),
                circle: document.getElementById('unit-circle-view'),
                table: document.getElementById('multiplication-table-view'),
                piano: document.getElementById('piano-view'),
                coords: document.getElementById('coordinate-system-view')
            };
            const toggleBtns = {
                calc: document.getElementById('toggle-calc'),
                clock: document.getElementById('toggle-clock'),
                circle: document.getElementById('toggle-circle'),
                table: document.getElementById('toggle-table'),
                piano: document.getElementById('toggle-piano'),
                coords: document.getElementById('toggle-coords')
            };

            const SYMBOLS_BIGINT = { 'œô': 0n, '√Æ': 1n, '…Ö': 2n, '·àê': 3n, 'ê§Ñ': 4n, '¬¨': 5n, 'ëÄ´': 6n, '‡Æ™': 7n, 'ëÄ¨': 8n, 'œ∑': 9n, 'êÖ°': 10n, 'êÜÖ': 11n };
            const SYMBOLS_DECIMAL = { 'œô': 0, '√Æ': 1, '…Ö': 2, '·àê': 3, 'ê§Ñ': 4, '¬¨': 5, 'ëÄ´': 6, '‡Æ™': 7, 'ëÄ¨': 8, 'œ∑': 9, 'êÖ°': 10, 'êÜÖ': 11 };
            const VALUE_TO_SYMBOL_BIGINT = Object.fromEntries(Object.entries(SYMBOLS_BIGINT).map(([s, v]) => [v, s]));
            const VALUE_TO_SYMBOL_DECIMAL = Object.fromEntries(Object.entries(SYMBOLS_DECIMAL).map(([s, v]) => [v, s]));
            const toDozBigInt = (decimalBigInt) => { if (decimalBigInt === 0n) return 'œô'; if (decimalBigInt < 0n) return '-' + toDozBigInt(-decimalBigInt); let result = ''; let num = decimalBigInt; while (num > 0n) { result = VALUE_TO_SYMBOL_BIGINT[num % 12n] + result; num = num / 12n; } return result; };
            const toDecimalBigInt = (s) => [...s].reduce((a, c) => (SYMBOLS_BIGINT[c] !== undefined) ? (a * 12n) + SYMBOLS_BIGINT[c] : a, 0n);
            function decimalToDoz(decimal, precision = 8) { if (decimal === 0) return 'œô'; let sign = decimal < 0 ? '-' : ''; decimal = Math.abs(decimal); let integerPart = Math.floor(decimal); let fractionalPart = decimal - integerPart; let intDoz = integerPart === 0 ? '' : toDozBigInt(BigInt(integerPart)); if (fractionalPart === 0) return sign + (intDoz || 'œô'); let fracDoz = '.'; for (let i = 0; i < precision; i++) { fractionalPart *= 12; let digit = Math.floor(fractionalPart); fracDoz += VALUE_TO_SYMBOL_DECIMAL[digit]; fractionalPart -= digit; if (fractionalPart < 1e-9) break; } return sign + (intDoz || 'œô') + fracDoz; }
            function dozToDecimal(dozStr) { if (!dozStr || typeof dozStr !== 'string') return 0; const isNegative = dozStr.startsWith('-'); if(isNegative) dozStr = dozStr.substring(1); const parts = dozStr.split('.'); const integerPartStr = parts[0]; const fractionalPartStr = parts.length > 1 ? parts[1] : ''; let decimalValue = [...integerPartStr].reduce((acc, char) => (SYMBOLS_DECIMAL[char] !== undefined ? (acc * 12) + SYMBOLS_DECIMAL[char] : acc), 0); if (fractionalPartStr) { let fractionalValue = 0; for (let i = 0; i < fractionalPartStr.length; i++) { const char = fractionalPartStr[i]; if (SYMBOLS_DECIMAL[char] !== undefined) { fractionalValue += SYMBOLS_DECIMAL[char] * Math.pow(12, -(i + 1)); } } decimalValue += fractionalValue; } return isNegative ? -decimalValue : decimalValue; }

            // --- N√ÑKYM√ÑN VAIHTO ---
            function switchView(viewName) {
                Object.values(views).forEach(v => v.style.display = 'none');
                views[viewName].style.display = 'flex';
                if (viewName === 'calc') { resetCalculator(); switchCalcSubView('calc'); } 
                else if (viewName === 'circle') { drawUnitCircle(); } 
                else if (viewName === 'clock') { if (!clockInterval) { setupClock(); } }
                else if (viewName === 'coords' && !views.coords.dataset.initialized) { setup3DScene(); views.coords.dataset.initialized = 'true';}
            }
            Object.keys(toggleBtns).forEach(key => { toggleBtns[key].addEventListener('click', () => switchView(key))});

            // --- LASKIN & ALIN√ÑKYM√ÑT ---
            const calcSubViews = { calc: document.getElementById('calc-sub-view'), converter: document.getElementById('converter-view'), info: document.getElementById('info-view') };
            const calcSubNavBtns = { calc: document.getElementById('show-calc-btn'), converter: document.getElementById('show-converter-btn'), info: document.getElementById('show-info-btn') };
            function switchCalcSubView(subViewName) { Object.values(calcSubViews).forEach(v => v.style.display = 'none'); Object.values(calcSubNavBtns).forEach(b => b.classList.remove('active')); calcSubViews[subViewName].style.display = 'flex'; calcSubNavBtns[subViewName].classList.add('active'); }
            Object.keys(calcSubNavBtns).forEach(key => { calcSubNavBtns[key].addEventListener('click', () => switchCalcSubView(key)); });
            const calcDisplay = document.getElementById('display'); const calcKeys = document.getElementById('calc-keys'); let calcDisplayValue = 'œô', firstOperand = null, calcOperator = null, waitingForSecondOperand = false; function resetCalculator() { calcDisplayValue = 'œô'; firstOperand = null; calcOperator = null; waitingForSecondOperand = false; updateCalcDisplay(); }; function updateCalcDisplay() { calcDisplay.textContent = calcDisplayValue; }; calcKeys.addEventListener('click', e => { const { target } = e; if (!target.matches('button:not(:disabled)')) return; const value = target.dataset.value; const op = target.dataset.calcOp; const largeNum = {'‡®®': 12n ** 3n, '—™': 12n ** 9n, 'Ïò§': 12n ** 27n}; if (value) { if (largeNum[value]) { calcDisplayValue = toDozBigInt(largeNum[value]); waitingForSecondOperand = false; } else { if (waitingForSecondOperand) { calcDisplayValue = value; waitingForSecondOperand = false; } else { calcDisplayValue = (calcDisplayValue === 'œô') ? value : calcDisplayValue + value; } } } else if (op) { if (op === '=') { if (calcOperator && firstOperand !== null) { const secondOperand = toDecimalBigInt(calcDisplayValue); if (calcOperator === '/' && secondOperand === 0n) { alert("Nollalla jako ei ole sallittu."); resetCalculator(); return; } let result = 0n; switch (calcOperator) { case '+': result = firstOperand + secondOperand; break; case '-': result = firstOperand - secondOperand; break; case '*': result = firstOperand * secondOperand; break; case '/': result = firstOperand / secondOperand; break; } calcDisplayValue = toDozBigInt(result); firstOperand = null; calcOperator = null; } } else if (op === 'clear') { resetCalculator(); } else { const inputValue = toDecimalBigInt(calcDisplayValue); if (calcOperator && waitingForSecondOperand) { calcOperator = op; return; } if (firstOperand === null) { firstOperand = inputValue; } waitingForSecondOperand = true; calcOperator = op; } } updateCalcDisplay(); });
            
            // MUUNTIMEN LOGIIKKA
            const dozInput = document.getElementById('doz-input'); const decInput = document.getElementById('dec-input'); let isUpdating = false;
            dozInput.addEventListener('input', () => { if(isUpdating) return; isUpdating = true; const decValue = dozToDecimal(dozInput.value); decInput.value = isNaN(decValue) ? "" : (decValue === 0 && dozInput.value !== 'œô' && dozInput.value !== '0' ? "" : decValue.toString()); isUpdating = false; });
            decInput.addEventListener('input', () => { if(isUpdating) return; isUpdating = true; const num = parseFloat(decInput.value); dozInput.value = isNaN(num) ? "" : decimalToDoz(num); isUpdating = false; });

            // --- KELLON LOGIIKKA ---
            const clockFace = document.getElementById('clock-face'); const timezoneSelect = document.getElementById('timezone-select'); let clockInterval = null;
            function setClockHands() { const hourHand = document.getElementById('hour-hand'); const minuteHand = document.getElementById('minute-hand'); const secondHand = document.getElementById('second-hand'); const monthHand = document.getElementById('month-hand'); const yearDisplay = document.getElementById('year-display'); const pmIndicator = document.getElementById('pm-indicator'); const selectedTz = timezoneSelect.value; const now = new Date(); const getLocalizedPart = (part, options = {}) => new Intl.DateTimeFormat('en-US', { timeZone: selectedTz, ...options }).format(now); const displayYear = BigInt(getLocalizedPart('year', { year: 'numeric' })); const hours = parseInt(getLocalizedPart('hour', { hour: 'numeric', hourCycle: 'h23' }), 10); const minutes = parseInt(getLocalizedPart('minute', { minute: 'numeric' }), 10); const seconds = parseInt(getLocalizedPart('second', { second: 'numeric' }), 10); const month = now.getMonth(); const day = now.getDate(); const daysInMonth = new Date(now.getFullYear(), month + 1, 0).getDate(); const monthProgress = day / daysInMonth; const monthDegrees = ((((month + 1) % 12) + monthProgress) / 12) * 360; const secondsDegrees = (seconds / 60) * 360; const minutesDegrees = (minutes / 60) * 360 + (seconds/60) * 6; const hoursDegrees = ((hours % 12) / 12) * 360 + (minutes / 60) * 30; if(hours >= 12){ hourHand.style.background = '#add8e6'; pmIndicator.textContent = '√Æœô+'; } else { hourHand.style.background = '#007acc'; pmIndicator.textContent = ''; } if(hourHand) hourHand.style.transform = `rotate(${hoursDegrees}deg)`; if(minuteHand) minuteHand.style.transform = `rotate(${minutesDegrees}deg)`; if(secondHand) secondHand.style.transform = `rotate(${secondsDegrees}deg)`; if(monthHand) monthHand.style.transform = `rotate(${monthDegrees}deg)`; if(yearDisplay) yearDisplay.textContent = toDozBigInt(displayYear); }
            function setupClock() { if (timezoneSelect.options.length === 0) { const timezones = Intl.supportedValuesOf('timeZone'); const currentUserTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone; timezones.forEach(tz => { const option = document.createElement('option'); option.value = tz; option.textContent = tz.replace(/_/g, ' '); if (tz === currentUserTimezone) { option.selected = true; } timezoneSelect.appendChild(option); }); } if (!clockFace.querySelector('.number')) { const dozenalNumerals = ['œô', '√Æ', '…Ö', '·àê', 'ê§Ñ', '¬¨', 'ëÄ´', '‡Æ™', 'ëÄ¨', 'œ∑', 'êÖ°', 'êÜÖ']; const radiusPercent = 42; dozenalNumerals.forEach((numeral, i) => { const clockNum = (i === 0) ? 12 : i; const angle = (clockNum / 12) * 2 * Math.PI - Math.PI / 2; const x = 50 + radiusPercent * Math.cos(angle); const y = 50 + radiusPercent * Math.sin(angle); const numElement = document.createElement('div'); numElement.className = 'number'; numElement.textContent = numeral; numElement.style.left = `${x}%`; numElement.style.top = `${y}%`; clockFace.appendChild(numElement); }); } setClockHands(); if (clockInterval) clearInterval(clockInterval); clockInterval = setInterval(setClockHands, 1000); timezoneSelect.addEventListener('change', setClockHands); }

            // --- YKSIKK√ñYMPYR√Ñ ---
            const circleCanvas = document.getElementById('unit-circle-canvas'), ctx = circleCanvas.getContext('2d'), circleDisplay = document.getElementById('circle-display'), circleKeys = document.getElementById('circle-keys'), formulaDisplay = document.getElementById('formula-display'); let circleInput = 'œô', activeTrigFunc = null, waitingForCircleInput = false; const FORMULAS = { sin: 'sin(Œ∏) = vastainen / hypotenuusa', cos: 'cos(Œ∏) = viereinen / hypotenuusa', tan: 'tan(Œ∏) = vastainen / viereinen', phi: 'œÜ = (a + b) / a = a / b = (1 + ‚àö5) / 2', pi: 'œÄ = Keh√§ (C) / Halkaisija (d)' };
            function updateCircleDisplay() { if (waitingForCircleInput) { circleDisplay.textContent = `${activeTrigFunc}(${circleInput})`; } else { circleDisplay.textContent = circleInput; } }
            function drawUnitCircle(angleRad = null, func = null) { const w = circleCanvas.width, h = circleCanvas.height, cx = w / 2, cy = h / 2, radius = Math.min(w, h) / 2 - 30; ctx.clearRect(0, 0, w, h); ctx.strokeStyle = '#666'; ctx.beginPath(); ctx.moveTo(0, cy); ctx.lineTo(w, cy); ctx.moveTo(cx, 0); ctx.lineTo(cx, h); ctx.stroke(); ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.beginPath(); ctx.arc(cx, cy, radius, 0, 2 * Math.PI); ctx.stroke(); ctx.fillStyle = '#fff'; ctx.font = '16px Segoe UI'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; const dozenalNumerals = ['œô', '√Æ', '…Ö', '·àê', 'ê§Ñ', '¬¨', 'ëÄ´', '‡Æ™', 'ëÄ¨', 'œ∑', 'êÖ°', 'êÜÖ']; for (let i = 0; i < 12; i++) { const clockNum = (i === 0) ? 12 : i; const angle = -(clockNum / 12) * 2 * Math.PI + (Math.PI / 2); const x = cx + (radius + 15) * Math.cos(angle); const y = cy - (radius + 15) * Math.sin(angle); ctx.fillText(dozenalNumerals[i], x, y); } if (func === 'pi') { ctx.strokeStyle = '#ffd700'; ctx.lineWidth = 3; ctx.beginPath(); ctx.moveTo(cx - radius, cy); ctx.lineTo(cx + radius, cy); ctx.stroke(); ctx.strokeStyle = '#ff4444'; ctx.beginPath(); ctx.arc(cx, cy, radius, 0, 2 * Math.PI); ctx.stroke(); ctx.fillStyle = '#ffd700'; ctx.font = 'bold 16px Courier New'; ctx.textAlign = 'center'; ctx.fillText('d', cx, cy + 15); ctx.textAlign = 'left'; ctx.fillText('C', cx + radius + 5, cy); } else if (func === 'phi') { const startAngle = -Math.PI / 2; const endAngle = startAngle + angleRad; ctx.strokeStyle = '#aaa'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(cx, cy - radius); ctx.stroke(); ctx.strokeStyle = '#00aaff'; ctx.lineWidth = 3; ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(cx + radius * Math.cos(endAngle), cy + radius * Math.sin(endAngle)); ctx.stroke(); ctx.lineWidth = 2; ctx.beginPath(); ctx.arc(cx, cy, radius * 0.4, startAngle, endAngle, false); ctx.stroke(); } else if (angleRad !== null) { const transformedAngle = -angleRad + (Math.PI / 2); const x_p = cx + radius * Math.cos(transformedAngle), y_p = cy - radius * Math.sin(transformedAngle); ctx.strokeStyle = '#00aaff'; ctx.lineWidth = 3; ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(x_p, y_p); ctx.stroke(); if (func === 'sin') { ctx.strokeStyle = '#ff4444'; ctx.beginPath(); ctx.moveTo(x_p, y_p); ctx.lineTo(x_p, cy); ctx.stroke(); } else if (func === 'cos') { ctx.strokeStyle = '#44ff44'; ctx.beginPath(); ctx.moveTo(x_p, y_p); ctx.lineTo(cx, y_p); ctx.stroke(); } } }
            circleKeys.addEventListener('click', (e) => { const { target } = e; if (!target.matches('button')) return; const circleVal = target.dataset.circleVal, trigFunc = target.dataset.trig; const inputDecimalForCircle = dozToDecimal(circleInput); if (circleVal) { if (!waitingForCircleInput) { activeTrigFunc = null; formulaDisplay.textContent = ''; } circleInput = (circleInput === 'œô') ? circleVal : circleInput + circleVal; } else if (trigFunc) { formulaDisplay.textContent = FORMULAS[trigFunc] || ''; if (trigFunc === 'pi') { circleInput = decimalToDoz(Math.PI, 8); activeTrigFunc = null; waitingForCircleInput = false; drawUnitCircle(null, 'pi'); } else if (trigFunc === 'phi') { const phi = (1 + Math.sqrt(5)) / 2; circleInput = decimalToDoz(phi, 8); activeTrigFunc = null; waitingForCircleInput = false; const angleForPhi = 137.5 * (Math.PI / 180); drawUnitCircle(angleForPhi, 'phi'); } else { activeTrigFunc = trigFunc; circleInput = 'œô'; waitingForCircleInput = true; } } else if (target.id === 'circle-clear') { circleInput = 'œô'; activeTrigFunc = null; waitingForCircleInput = false; drawUnitCircle(); formulaDisplay.textContent = ''; } else if (target.id === 'circle-equals') { if (activeTrigFunc && waitingForCircleInput) { const angleDegrees = (inputDecimalForCircle / 12) * 360; const angleRadians = angleDegrees * (Math.PI / 180); let result; if (activeTrigFunc === 'tan' && Math.abs(Math.cos(angleRadians)) < 1e-10) { result = 'M√§√§rittelem√§t√∂n'; } else { result = Math[activeTrigFunc](angleRadians); result = decimalToDoz(result, 8); } circleInput = result; drawUnitCircle(angleRadians, activeTrigFunc); waitingForCircleInput = false; } } updateCircleDisplay(); });

            // --- KERTOTAULU JA JAKOTAULU ---
            function generateTables() { const container = document.getElementById('multiplication-table-view'); if (container.childElementCount > 0) return; container.innerHTML = '<h2>Kertotaulu</h2><table class="mult-table" id="mult-table-container"></table><h2>Jakotaulu</h2><table class="mult-table" id="div-table-container"></table>'; const multTable = document.getElementById('mult-table-container'); const divTable = document.getElementById('div-table-container'); let multHtml = '<thead><tr><th>√ó</th>'; let divHtml = '<thead><tr><th>√∑</th>'; for (let i = 1; i <= 12; i++) { const doz = i === 12 ? toDozBigInt(12n) : toDozBigInt(BigInt(i)); multHtml += `<th>${doz}</th>`; divHtml += `<th>${doz}</th>`; } multHtml += '</tr></thead><tbody>'; divHtml += '</tr></thead><tbody>'; for (let i = 1; i <= 12; i++) { const doz_i = i === 12 ? toDozBigInt(12n) : toDozBigInt(BigInt(i)); multHtml += `<tr><th>${doz_i}</th>`; divHtml += `<tr><th>${doz_i}</th>`; for (let j = 1; j <= 12; j++) { multHtml += `<td>${toDozBigInt(BigInt(i * j))}</td>`; divHtml += `<td>${decimalToDoz(i / j, 2)}</td>`; } multHtml += '</tr>'; divHtml += '</tr>'; } multHtml += '</tbody>'; divHtml += '</tbody>'; multTable.innerHTML = multHtml; divTable.innerHTML = divHtml; }
            generateTables();

            // --- KOORDINAATISTO ---
            const coordsCanvas = document.getElementById('coords-canvas');
            const coordsDisplay = document.getElementById('coords-display');
            const coordsKeys = document.getElementById('coords-keys');
            let scene, camera, renderer, controls, graphGroup;

            // Apufunktiot erikoisfunktioille
            // Lanczos-approksimaatio Gamma-funktiolle (vain itseisarvo)
            function logGamma(z) {
                const g = 7;
                const p = [0.99999999999980993, 676.5203681218851, -1259.1392167224028, 771.32342877765313, -176.61502916214059, 12.507343278686905, -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7];
                if (z < 0.5) return Math.log(Math.PI / (Math.sin(Math.PI * z) * Math.exp(logGamma(1 - z))));
                z -= 1;
                let x = p[0];
                for (let i = 1; i < g + 2; i++) x += p[i] / (z + i);
                let t = z + g + 0.5;
                return Math.log(Math.sqrt(2 * Math.PI) * Math.pow(t, z + 0.5) * Math.exp(-t) * x);
            }
            function absGamma(x, y) {
                 const temp = (x - 0.5) * Math.log(x*x + y*y) - y * Math.atan2(y, x) + x - 0.5 * Math.log(2 * Math.PI);
                 return Math.exp(temp);
            }
            
            // Riemannin Zeeta-funktion reaaliosan approksimaatio summalla
            function realZeta(x, y, terms = 50) {
                let sum = 0;
                for (let n = 1; n <= terms; n++) {
                    const n_x = Math.pow(n, -x);
                    const term = n_x * Math.cos(y * Math.log(n));
                    sum += term;
                }
                return sum;
            }

            function createAxisLabel(text, position, color, size = 48, scale = 5) {
                const canvas = document.createElement('canvas'); const context = canvas.getContext('2d'); const font = `${size}px Arial`; context.font = font; const metrics = context.measureText(text); const textWidth = metrics.width; canvas.width = textWidth + 10; canvas.height = size + 10; context.font = font; context.fillStyle = color; context.textAlign = 'center'; context.textBaseline = 'middle'; context.fillText(text, canvas.width / 2, canvas.height / 2); const texture = new THREE.CanvasTexture(canvas); const material = new THREE.SpriteMaterial({ map: texture, depthTest: false }); const sprite = new THREE.Sprite(material); sprite.position.copy(position); sprite.scale.set(scale, scale * (canvas.height / canvas.width), 1.0); return sprite;
            }

            function setup3DScene() {
                scene = new THREE.Scene(); graphGroup = new THREE.Group(); scene.add(graphGroup); camera = new THREE.PerspectiveCamera(75, coordsCanvas.clientWidth / coordsCanvas.clientHeight, 0.1, 1000); renderer = new THREE.WebGLRenderer({ canvas: coordsCanvas, antialias: true, alpha: true }); renderer.setSize(coordsCanvas.clientWidth, coordsCanvas.clientHeight); renderer.setClearColor(0x000000, 0); controls = new OrbitControls(camera, renderer.domElement); const axesHelper = new THREE.AxesHelper(15); scene.add(axesHelper); const axisLength = 15; const labelScale = 7; const xLabel = createAxisLabel("Re(z)", new THREE.Vector3(axisLength + 2.5, 0, 0), '#FF7777', 48, labelScale); scene.add(xLabel); const yLabel = createAxisLabel("Re(f(z))", new THREE.Vector3(0, axisLength + 2.5, 0), '#77FF77', 48, labelScale); scene.add(yLabel); const zLabel = createAxisLabel("Im(z)", new THREE.Vector3(0, 0, axisLength + 2.5), '#7777FF', 48, labelScale); scene.add(zLabel); const ambientLight = new THREE.AmbientLight(0xffffff, 0.6); scene.add(ambientLight); const directionalLight = new THREE.DirectionalLight(0xffffff, 0.9); directionalLight.position.set(10, 20, 5); scene.add(directionalLight); animate3DScene();
            }

            function animate3DScene() { requestAnimationFrame(animate3DScene); controls.update(); renderer.render(scene, camera); }

            function plotGraph(funcType, power = null) {
                graphGroup.clear(); let displayString = ''; let surfaceFunction = null;

                if (funcType === 'power') {
                    switch (power) {
                        case 2: displayString = "y = Re(z¬≤)"; surfaceFunction = (x, z) => (x * x) - (z * z); break;
                        case 3: displayString = "y = Re(z¬≥)"; surfaceFunction = (x, z) => (x * x * x) - (3 * x * z * z); break;
                        case 4: displayString = "y = Re(z‚Å¥)"; surfaceFunction = (x, z) => Math.pow(x, 4) - (6 * x * x * z * z) + Math.pow(z, 4); break;
                        case 5: displayString = "y = Re(z‚Åµ)"; surfaceFunction = (x, z) => Math.pow(x, 5) - (10 * Math.pow(x, 3) * z * z) + (5 * x * Math.pow(z, 4)); break;
                    }
                } else {
                    switch (funcType) {
                        case 'sin': displayString = "y = Re(sin(z))"; surfaceFunction = (x, z) => Math.sin(x) * Math.cosh(z); break;
                        case 'cos': displayString = "y = Re(cos(z))"; surfaceFunction = (x, z) => Math.cos(x) * Math.cosh(z); break;
                        case 'tan': displayString = "y = Re(tan(z))"; surfaceFunction = (x, z) => { const d = Math.cos(2*x) + Math.cosh(2*z); return d !== 0 ? Math.sin(2*x) / d : 0; }; break;
                        case 'log': displayString = "y = Re(log(z))"; surfaceFunction = (x, z) => Math.log(Math.sqrt((x * x) + (z * z))); break;
                        case 'exp': displayString = "y = Re(e·∂ª)"; surfaceFunction = (x, z) => Math.exp(x) * Math.cos(z); break;
                        case 'sqrt': displayString = "y = Re(‚àöz)"; surfaceFunction = (x, z) => { const r = Math.sqrt(x*x + z*z); return Math.sqrt((r + x) / 2); }; break;
                        case 'sinh': displayString = "y = Re(sinh(z))"; surfaceFunction = (x, z) => Math.sinh(x) * Math.cos(z); break;
                        case 'sinc': displayString = "y = Re(sinc(z))"; surfaceFunction = (x, z) => { const r2 = x*x + z*z; if (r2 === 0) return 1; return (x*Math.sin(x)*Math.cosh(z) + z*Math.cos(x)*Math.sinh(z)) / r2; }; break;
                        case 'gamma': displayString = "y = |Œì(z)|"; surfaceFunction = (x, z) => absGamma(x,z); break;
                        case 'zeta': displayString = "y = Re(Œ∂(z))"; surfaceFunction = (x, z) => realZeta(x, z, 40); break;
                    }
                }

                if (!surfaceFunction) { coordsDisplay.textContent = 'Valitse funktio'; return; }
                coordsDisplay.textContent = displayString;

                const range = funcType === 'zeta' ? 15 : 5;
                const segments = 80;
                
                const geometry = new THREE.PlaneGeometry(range * 2, range * 2, segments, segments);
                geometry.rotateX(-Math.PI / 2);

                const positions = geometry.attributes.position;
                const yClamp = 15;

                for (let i = 0; i < positions.count; i++) {
                    const x = positions.getX(i);
                    const z = positions.getZ(i);
                    let y = surfaceFunction(x, z);
                    
                    y = isNaN(y) || !isFinite(y) ? 0 : Math.max(-yClamp, Math.min(yClamp, y)); 
                    positions.setY(i, y);
                }
                
                positions.needsUpdate = true;
                geometry.computeVertexNormals();

                const material = new THREE.MeshStandardMaterial({ color: 0x2196F3, side: THREE.DoubleSide, metalness: 0.3, roughness: 0.6 });
                const surface = new THREE.Mesh(geometry, material);
                graphGroup.add(surface);

                const gridHelper = new THREE.GridHelper(range * 2, range, 0x888888, 0x444444);
                graphGroup.add(gridHelper);

                camera.position.set(range * 1.5, range * 2, range * 2.5);
                controls.target.set(0, 0, 0);
                controls.update();
            }
            
            coordsKeys.addEventListener('click', e => {
                const { target } = e;
                if (!target.matches('button:not(:disabled)')) return;
                const power = target.dataset.power;
                const func = target.dataset.func;

                if (power) { plotGraph('power', parseInt(power)); }
                else if (func) { plotGraph(func); }
                else if (target.id === 'coords-clear') { graphGroup.clear(); coordsDisplay.textContent = 'Valitse funktio'; }
            });

            // Alusta oletusn√§kym√§
            switchView('calc');
        });
    </script>
</body>
</html>
